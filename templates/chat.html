{% extends "base.html" %}

{% block title %}SparkOS - AI Chat{% endblock %}

{% block extra_css %}
<style>
    .chat-container {
        height: calc(100vh - 200px);
        max-height: 600px;
    }
    .messages {
        height: calc(100% - 60px);
        overflow-y: auto;
    }
    .typing-indicator {
        display: none;
    }
    .typing-indicator span {
        height: 8px;
        width: 8px;
        background-color: #9CA3AF;
        border-radius: 50%;
        display: inline-block;
        margin: 0 2px;
        animation: bounce 1.4s infinite ease-in-out both;
    }
    .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
    .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
    @keyframes bounce {
        0%, 80%, 100% { transform: scale(0); }
        40% { transform: scale(1.0); }
    }
</style>
{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto">
    <!-- Header -->
    <div class="text-center mb-6">
        <h1 class="text-2xl font-bold text-gray-800">AI Companion</h1>
        <p class="text-gray-600">Your personal assistant and study buddy</p>
    </div>

    <!-- Chat Interface -->
    <div class="bg-white rounded-lg shadow-md overflow-hidden">
        <!-- Chat Header -->
        <div class="bg-indigo-600 text-white p-4 flex items-center">
            <div class="w-10 h-10 rounded-full bg-indigo-500 flex items-center justify-center mr-3">
                <i class="fas fa-robot text-xl"></i>
            </div>
            <div>
                <h2 class="font-semibold">Sparky</h2>
                <div class="text-xs text-indigo-200">Online</div>
            </div>
            <div class="ml-auto flex space-x-2">
                <button id="study-mode-btn" class="p-1 rounded-full hover:bg-indigo-500" title="Study Mode">
                    <i class="fas fa-graduation-cap"></i>
                </button>
                <button id="casual-mode-btn" class="p-1 rounded-full hover:bg-indigo-500" title="Casual Mode">
                    <i class="fas fa-comment-alt"></i>
                </button>
                <button id="clear-chat-btn" class="p-1 rounded-full hover:bg-indigo-500" title="Clear Chat">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>

        <!-- Chat Messages -->
        <div class="chat-container flex flex-col">
            <div class="messages p-4 space-y-4" id="chat-messages">
                <!-- Welcome Message -->
                <div class="flex items-start">
                    <div class="flex-shrink-0 h-8 w-8 rounded-full bg-indigo-100 flex items-center justify-center mr-2">
                        <i class="fas fa-robot text-indigo-600"></i>
                    </div>
                    <div class="bg-gray-100 rounded-lg p-3 max-w-xs md:max-w-md">
                        <p class="text-sm text-gray-800">Hi there! I'm Sparky, your AI companion. How can I help you today? You can ask me to explain concepts, help with homework, or just chat!</p>
                        <div class="text-xs text-gray-500 mt-1">Just now</div>
                    </div>
                </div>

                <!-- Mode Selector -->
                <div class="text-center py-4">
                    <div class="inline-flex rounded-md shadow-sm" role="group">
                        <button type="button" class="mode-btn px-4 py-2 text-sm font-medium rounded-l-lg border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 focus:z-10 focus:ring-2 focus:ring-indigo-500" data-mode="study">
                            <i class="fas fa-graduation-cap mr-2"></i> Study Mode
                        </button>
                        <button type="button" class="mode-btn px-4 py-2 text-sm font-medium border-t border-b border-r border-gray-300 bg-white text-gray-700 hover:bg-gray-50 focus:z-10 focus:ring-2 focus:ring-indigo-500" data-mode="math">
                            <i class="fas fa-calculator mr-2"></i> Math Help
                        </button>
                        <button type="button" class="mode-btn px-4 py-2 text-sm font-medium rounded-r-lg border border-gray-300 bg-white text-gray-700 hover:bg-gray-50 focus:z-10 focus:ring-2 focus:ring-indigo-500" data-mode="casual">
                            <i class="fas fa-comment-alt mr-2"></i> Casual Chat
                        </button>
                    </div>
                </div>
            </div>

            <!-- Typing Indicator -->
            <div id="typing-indicator" class="typing-indicator px-6 py-2">
                <div class="flex items-center">
                    <div class="flex-shrink-0 h-8 w-8 rounded-full bg-indigo-100 flex items-center justify-center mr-2">
                        <i class="fas fa-robot text-indigo-600"></i>
                    </div>
                    <div class="bg-gray-100 rounded-lg p-3">
                        <div class="flex space-x-1">
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Message Input -->
            <div class="border-t border-gray-200 p-4">
                <form id="message-form" class="flex space-x-2">
                    <div class="relative flex-1">
                        <input type="text" id="message-input" class="w-full rounded-full border border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 pl-4 pr-10 py-2" placeholder="Type your message..." autocomplete="off">
                        <button type="button" id="send-message-btn" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-indigo-600 hover:text-indigo-800">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="mt-6 grid grid-cols-2 md:grid-c-4 gap-3">
        <button class="quick-action-btn bg-blue-50 hover:bg-blue-100 text-blue-700 border border-blue-200 rounded-lg p-3 text-sm font-medium transition">
            <i class="fas fa-book-open mr-2"></i> Explain a concept
        </button>
        <button class="quick-action-btn bg-green-50 hover:bg-green-100 text-green-700 border border-green-200 rounded-lg p-3 text-sm font-medium transition">
            <i class="fas fa-calculator mr-2"></i> Solve a math problem
        </button>
        <button class="quick-action-btn bg-purple-50 hover:bg-purple-100 text-purple-700 border border-purple-200 rounded-lg p-3 text-sm font-medium transition">
            <i class="fas fa-question-circle mr-2"></i> Ask a question
        </button>
        <button class="quick-action-btn bg-yellow-50 hover:bg-yellow-100 text-yellow-700 border border-yellow-200 rounded-lg p-3 text-sm font-medium transition">
            <i class="fas fa-lightbulb mr-2"></i> Get study tips
        </button>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Chat functionality
document.addEventListener('DOMContentLoaded', function() {
    const messageForm = document.getElementById('message-form');
    const messageInput = document.getElementById('message-input');
    const chatMessages = document.getElementById('chat-messages');
    const sendButton = document.getElementById('send-message-btn');
    const typingIndicator = document.getElementById('typing-indicator');
    const quickActionButtons = document.querySelectorAll('.quick-action-btn');
    const modeButtons = document.querySelectorAll('.mode-btn');
    let currentMode = 'casual';

    // Add message to chat
    function addMessage(sender, message, isUser = false) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `flex items-start ${isUser ? 'justify-end' : ''}`;
        
        if (!isUser) {
            messageDiv.innerHTML = `
                <div class="flex-shrink-0 h-8 w-8 rounded-full bg-indigo-100 flex items-center justify-center mr-2">
                    <i class="fas fa-robot text-indigo-600"></i>
                </div>
                <div class="bg-gray-100 rounded-lg p-3 max-w-xs md:max-w-md">
                    <p class="text-sm text-gray-800">${message}</p>
                    <div class="text-xs text-gray-500 mt-1">Just now</div>
                </div>
            `;
        } else {
            messageDiv.innerHTML = `
                <div class="bg-indigo-600 text-white rounded-lg p-3 max-w-xs md:max-w-md">
                    <p class="text-sm">${message}</p>
                    <div class="text-xs text-indigo-200 mt-1">Just now</div>
                </div>
            `;
        }
        
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Show typing indicator
    function showTypingIndicator() {
        typingIndicator.style.display = 'block';
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Hide typing indicator
    function hideTypingIndicator() {
        typingIndicator.style.display = 'none';
    }

    // Handle form submission
    messageForm.addEventListener('submit', function(e) {
        e.preventDefault();
        sendMessage();
    });

    // Send message when button is clicked
    sendButton.addEventListener('click', sendMessage);

    // Send message function
    function sendMessage() {
        const message = messageInput.value.trim();
        if (message === '') return;

        // Add user message to chat
        addMessage('user', message, true);
        messageInput.value = '';

        // Show typing indicator
        showTypingIndicator();

        // Simulate bot response (in a real app, this would be an API call)
        setTimeout(() => {
            hideTypingIndicator();
            const responses = {
                'study': 'I can help explain that concept. Here\'s a detailed explanation...',
                'math': 'Let me help you solve that math problem step by step...',
                'casual': 'That\'s interesting! Tell me more about it.'
            };
            addMessage('bot', responses[currentMode] || 'I\'m not sure how to respond to that.');
        }, 1000 + Math.random() * 2000);
    }

    // Quick action buttons
    quickActionButtons.forEach(button => {
        button.addEventListener('click', function() {
            const actionText = this.textContent.trim();
            messageInput.value = actionText;
            messageInput.focus();
        });
    });

    // Mode selection
    modeButtons.forEach(button => {
        button.addEventListener('click', function() {
            currentMode = this.dataset.mode;
            
            // Update active state
            modeButtons.forEach(btn => {
                if (btn === this) {
                    btn.classList.add('bg-indigo-100', 'text-indigo-700', 'border-indigo-300');
                    btn.classList.remove('bg-white', 'text-gray-700');
                } else {
                    btn.classList.remove('bg-indigo-100', 'text-indigo-700', 'border-indigo-300');
                    btn.classList.add('bg-white', 'text-gray-700');
                }
            });

            // Show mode change message
            const modeMessages = {
                'study': 'Switched to Study Mode. I can help with homework and explain concepts!',
                'math': 'Switched to Math Help Mode. What problem can I help you solve?',
                'casual': 'Switched to Casual Chat Mode. What would you like to talk about?'
            };
            
            showTypingIndicator();
            setTimeout(() => {
                hideTypingIndicator();
                addMessage('bot', modeMessages[currentMode]);
            }, 500);
        });
    });

    // Set default mode
    document.querySelector('.mode-btn[data-mode="casual"]').click();

    // Clear chat button
    document.getElementById('clear-chat-btn').addEventListener('click', function() {
        // Keep only the welcome message and mode selector
        while (chatMessages.children.length > 2) {
            chatMessages.removeChild(chatMessages.lastChild);
        }
        addMessage('bot', 'Chat history has been cleared. How can I help you today?');
    });

    // Allow sending message with Enter key
    messageInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendMessage();
        }
    });
});
</script>
{% endblock %}
